# R20-P00 â€” Prerequisites & Scope Lock

- Timestamp (UTC): 2026-02-21T13:03:49Z
- Phase: P00 (Worker)
- Plan: `project-plans/gmerge-0.21.3/560550f5df78-plan.md`

## Scope lock statement
Scope is locked to **R20 MCP Resources only**: MCP resource discovery, registry, read, `@server:uri` usage path, completion suggestions, MCP status/`/mcp` visibility, and MCP resource docs. No non-R20 expansion is authorized in this phase.

## Prerequisite checks
- `project-plans/gmerge-0.21.3/560550f5df78-plan.md`: present and readable.
- Working tree baseline (`git status --short`): clean (no output).
- P00 constraint respected: no code files modified in this phase.

## Upstream file-scope evidence
Command run:

    git show --name-status 560550f5df78

Observed upstream scope:
- docs/tools/mcp-server.md (M)
- packages/cli/src/ui/commands/mcpCommand.test.ts (M)
- packages/cli/src/ui/commands/mcpCommand.ts (M)
- packages/cli/src/ui/components/views/McpStatus.test.tsx (M)
- packages/cli/src/ui/components/views/McpStatus.tsx (M)
- packages/cli/src/ui/components/views/__snapshots__/McpStatus.test.tsx.snap (M)
- packages/cli/src/ui/hooks/atCommandProcessor.test.ts (M)
- packages/cli/src/ui/hooks/atCommandProcessor.ts (M)
- packages/cli/src/ui/hooks/useAtCompletion.test.ts (M)
- packages/cli/src/ui/hooks/useAtCompletion.ts (M)
- packages/cli/src/ui/types.ts (M)
- packages/cli/src/ui/utils/highlight.ts (M)
- packages/core/src/config/config.ts (M)
- packages/core/src/index.ts (M)
- packages/core/src/resources/resource-registry.test.ts (A)
- packages/core/src/resources/resource-registry.ts (A)
- packages/core/src/tools/mcp-client-manager.test.ts (M)
- packages/core/src/tools/mcp-client-manager.ts (M)
- packages/core/src/tools/mcp-client.test.ts (M)
- packages/core/src/tools/mcp-client.ts (M)

## Gap matrix (P00 baseline)

### In scope (R20)
1. Resource registry module missing in current branch baseline until implemented in later phases:
   - `packages/core/src/resources/resource-registry.ts`
   - `packages/core/src/resources/resource-registry.test.ts`
2. Config accessor/lifecycle plumbing for resource registry expected in:
   - `packages/core/src/config/config.ts`
3. Core exports to include resource registry expected in:
   - `packages/core/src/index.ts`
4. MCP client capability/discovery/read/cleanup resource flow expected in:
   - `packages/core/src/tools/mcp-client.ts`
   - `packages/core/src/tools/mcp-client-manager.ts`
   - paired tests
5. CLI `@` processor support for `serverName:uri` resource attachment expected in:
   - `packages/cli/src/ui/hooks/atCommandProcessor.ts`
   - paired tests
6. `@` completion resource suggestions expected in:
   - `packages/cli/src/ui/hooks/useAtCompletion.ts`
   - paired tests
7. MCP status and `/mcp` command visibility for resources expected in:
   - `packages/cli/src/ui/components/views/McpStatus.tsx`
   - `packages/cli/src/ui/commands/mcpCommand.ts`
   - paired tests/snapshots
8. Documentation coverage expected in:
   - `docs/tools/mcp-server.md`

### Out of scope (explicit)
- Any provider/model behavior changes unrelated to MCP resources.
- Refactors of unrelated modules.
- MCP protocol redesign beyond resource discovery/read/list-changed handling required by R20.
- UI redesign outside adding resource visibility.
- Feature work outside listed R20 files/slices.

## `git show --name-status 560550f5df78` evidence

    commit 560550f5df78a11f96464c91d358a8e0fbeb32c9
    Author: Alex Gavrilescu <leskcorp@gmail.com>
    Date:   Tue Dec 9 03:43:12 2025 +0100

        feat: Add support for MCP Resources (#13178)

    M	docs/tools/mcp-server.md
    M	packages/cli/src/ui/commands/mcpCommand.test.ts
    M	packages/cli/src/ui/commands/mcpCommand.ts
    M	packages/cli/src/ui/components/views/McpStatus.test.tsx
    M	packages/cli/src/ui/components/views/McpStatus.tsx
    M	packages/cli/src/ui/components/views/__snapshots__/McpStatus.test.tsx.snap
    M	packages/cli/src/ui/hooks/atCommandProcessor.test.ts
    M	packages/cli/src/ui/hooks/atCommandProcessor.ts
    M	packages/cli/src/ui/hooks/useAtCompletion.test.ts
    M	packages/cli/src/ui/hooks/useAtCompletion.ts
    M	packages/cli/src/ui/types.ts
    M	packages/cli/src/ui/utils/highlight.ts
    M	packages/core/src/config/config.ts
    M	packages/core/src/index.ts
    A	packages/core/src/resources/resource-registry.test.ts
    A	packages/core/src/resources/resource-registry.ts
    M	packages/core/src/tools/mcp-client-manager.test.ts
    M	packages/core/src/tools/mcp-client-manager.ts
    M	packages/core/src/tools/mcp-client.test.ts
    M	packages/core/src/tools/mcp-client.ts

## `git status --short` evidence
Command run:

    git status --short

Output:

    (empty)
