Phase: P01
Completed: 2025-02-19
Status: Preflight verification complete

## Verification Checklist

- [x] All dependencies verified
  - `clearCachedCredentialFile` — imported from `@vybestack/llxprt-code-core`
  - `loadProfileByName` — imported from `../runtime/runtimeSettings.js`
  - `getActiveProfileName` — exists in `../runtime/runtimeSettings.ts` line 1323, NOT yet imported
  - `parseZedAuthMethodId` — local function in `zedIntegration.ts`
- [x] All types match expectations
  - `getActiveProfileName()` returns `string | null`
  - `loadProfileByName(profileName)` is async, calls `applyProfileSnapshot` which updates settingsService synchronously
  - `profileManager.listProfiles()` returns `Promise<string[]>`
- [x] All call paths are possible
  - `getActiveProfileName` reads pre-load state; `applyProfileSnapshot` inside `loadProfileByName` updates the value synchronously
- [x] Test infrastructure status assessed
  - Existing tests for `parseZedAuthMethodId` in `zedIntegration.test.ts`
  - New mock scaffolding for `authenticate` tests must be added in P02

## LLxprt Invalidation Policy

**Policy:** Clear credential cache if and only if:
1. There is an active profile (`getActiveProfileName()` returns non-null), AND
2. The active profile name differs from the requested profile name (`currentProfile !== profileName`).

This mapping is conservative: may clear unnecessarily (two profiles, same account) but will never fail to clear when needed (different profiles always get clean credential state).

## No Blocking Issues

All dependencies verified, types confirmed, call paths validated. Ready to proceed to P02.
