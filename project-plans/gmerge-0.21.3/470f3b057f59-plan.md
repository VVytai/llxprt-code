# Plan: Reimplementation — Upstream Commit 470f3b057f59 (Remove Example Extension)

Plan ID: PLAN-20250219-GMERGE021.R9
Generated: 2025-02-19
Total Phases: 6 (P00.5, P01, P02, P03, P04, P05)
Requirements: Remove `custom-commands` example extension and all references to align with upstream commit `470f3b057f59b22d9022a2f1868267bc99c0f03b`

## Critical Reminders

Before implementing ANY phase, ensure you have:

1. Completed preflight verification (Phase P00.5)
2. Confirmed all filesystem and documentation references identified in Phase P00.5
3. Written the failing test update BEFORE deleting files (TDD mandate)
4. Verified no CI or automation references to `custom-commands`

---

## Upstream Commit Analysis

### Commit Details

- **Commit:** `470f3b057f59b22d9022a2f1868267bc99c0f03b`
- **Author:** christine betts <chrstn@uw.edu>
- **Date:** Wed Dec 3 19:16:13 2025 -0500
- **Message:** Remove example extension (#14376)

### Files Removed Upstream

| File | Description |
|------|-------------|
| `hello/commands/fs/grep-code.toml` | Example grep-code custom command |
| `hello/gemini-extension.json` | Example extension manifest |

### Removed Content

**hello/commands/fs/grep-code.toml:**
```toml
prompt = """
Please summarize the findings for the pattern `{{args}}`.

Search Results:
!{grep -r {{args}} .}
"""
```

**hello/gemini-extension.json:**
```json
{
  "name": "custom-commands",
  "version": "1.0.0"
}
```

### Functional Equivalence Assessment

LLxprt's files are **functionally similar** to, not byte-for-byte identical to, the upstream-removed files.

| Aspect | Upstream (`hello/`) | LLxprt (`examples/custom-commands/`) |
|--------|---------------------|---------------------------------------|
| Manifest filename | `gemini-extension.json` | `llxprt-extension.json` |
| Manifest path depth | repo root | nested under `examples/` |
| Manifest content | `{"name":"custom-commands","version":"1.0.0"}` | identical |
| TOML content | identical | identical |
| Schema used | Gemini extension schema | LLxprt extension schema (compatible) |

**Conclusion:** The `custom-commands` example is a renamed/relocated equivalent of the upstream-removed example and serves the same purpose. There is no LLxprt-specific behavior added to this example; it is a direct analogue.

---

# Phase P00.5: Preflight Verification

## Phase ID

`PLAN-20250219-GMERGE021.R9.P00.5`

## Purpose

Verify ALL assumptions before writing any code or deleting any files.

## Prerequisites

- None — this is the first phase.

## Dependency Verification

| Dependency | Verification Method | Status |
|------------|--------------------|---------| 
| `new.ts` uses dynamic `readdir` (no hardcoded `custom-commands`) | `grep -r "custom-commands" packages/cli/src/commands/extensions/new.ts` | Expected: no matches |
| `new.test.ts` mock includes `custom-commands` | `grep "custom-commands" packages/cli/src/commands/extensions/new.test.ts` | Expected: match found |
| CI/scripts reference `custom-commands` | `grep -r "custom-commands" .github/ scripts/` | Expected: no matches |
| Docs reference `custom-commands` | `grep -rn "custom-commands\|grep-code" docs/` | Expected: matches at `docs/cli/commands.md:235–258` and `docs/extension.md:129` |

## Filesystem Verification

```bash
# Confirm target files exist
ls packages/cli/src/commands/extensions/examples/custom-commands/
ls packages/cli/src/commands/extensions/examples/custom-commands/commands/fs/
```

Expected:
```
custom-commands/
├── commands/
│   └── fs/
│       └── grep-code.toml
└── llxprt-extension.json
```

## Type/Interface Verification

| Component | Expected Behavior | Verification |
|-----------|-------------------|--------------|
| `getBoilerplateChoices()` in `new.ts` | Reads template names from `readdir(EXAMPLES_PATH)` dynamically | `grep -n "readdir\|EXAMPLES_PATH" packages/cli/src/commands/extensions/new.ts` |
| `new.test.ts` mock | `fakeFiles` array includes `{ name: 'custom-commands', isDirectory: () => true }` | Direct file inspection |

## Verification Gate

- [ ] Target files confirmed present at expected paths
- [ ] `new.ts` confirmed to use dynamic `readdir` (no hardcoded `custom-commands`)
- [ ] `new.test.ts` mock confirmed to include `custom-commands`
- [ ] CI/scripts confirmed to have no `custom-commands` references
- [ ] Both docs locations confirmed

IF ANY CHECKBOX IS UNCHECKED: STOP and update plan before proceeding.

---

# Phase P01: Test Update (TDD First Step)

## Phase ID

`PLAN-20250219-GMERGE021.R9.P01`

## Prerequisites

- Required: Phase P00.5 completed and all gate checks passed
- Verification: All preflight checkboxes confirmed above

## Requirements Implemented (Expanded)

### REQ-GMERGE-R9-001: Test Mock Reflects Post-Deletion World

**Full Text**: The test mock in `new.test.ts` MUST be updated to remove `custom-commands` from the `fakeFiles` array before any files are deleted, so the test reflects the expected post-deletion state.

**Behavior**:
- GIVEN: `new.test.ts` currently mocks `fakeFiles` with `custom-commands` included
- WHEN: The mock is updated to remove `custom-commands`
- THEN: Tests still pass (the mock is filesystem-independent), and the mock now correctly represents the post-deletion world

**Why This Matters**: TDD mandate requires the test to be updated before the implementation change (file deletion). This ensures the test would catch a regression if `custom-commands` were accidentally re-added.

## Implementation Tasks

### Files to Modify

- `packages/cli/src/commands/extensions/new.test.ts`
  - Locate the `beforeEach` mock `fakeFiles` array
  - Remove `{ name: 'custom-commands', isDirectory: () => true }` from the array
  - Audit all four test cases — confirm none assert the exact template list or count in a way that breaks
  - ADD comment: `@plan:PLAN-20250219-GMERGE021.R9.P01`
  - Implements: `@requirement:REQ-GMERGE-R9-001`

### Required Code Markers

```typescript
/**
 * @plan PLAN-20250219-GMERGE021.R9.P01
 * @requirement REQ-GMERGE-R9-001
 */
// Removed custom-commands from fakeFiles — no longer a valid template (upstream 470f3b057f59)
```

## Verification Commands

### Automated Checks

```bash
# Confirm custom-commands removed from mock
grep "custom-commands" packages/cli/src/commands/extensions/new.test.ts
# Expected: no matches

# Confirm plan marker present
grep "@plan:PLAN-20250219-GMERGE021.R9.P01" packages/cli/src/commands/extensions/new.test.ts
# Expected: 1+ matches

# Run tests — must still pass (mock is filesystem-independent)
npm test -- --testPathPattern="new.test"
# Expected: all pass
```

### Structural Verification Checklist

- [ ] `custom-commands` removed from `fakeFiles` mock array
- [ ] No test case asserts `custom-commands` is present in choices
- [ ] Plan marker added
- [ ] Tests pass after mock update

### Semantic Verification Checklist

1. **Does the code DO what the requirement says?**
   - [ ] Mock updated to reflect post-deletion state
   - [ ] Tests still pass (mock is filesystem-independent)
   - [ ] A future regression adding `custom-commands` back would NOT break this test (the test doesn't assert presence, only absence after deletion)

2. **Is this REAL implementation, not placeholder?**
   - [ ] Actual mock array edited, not just commented out
   - [ ] No deferred changes

3. **Would the test FAIL if implementation was removed?**
   - [ ] After P03 (file deletion), if `custom-commands` were accidentally re-added to disk, this mock correctly does not include it — the real `getBoilerplateChoices()` would then surface the mismatch in integration

4. **Is the feature REACHABLE by users?**
   - [ ] `new.test.ts` is run in CI — this change takes effect immediately

## Success Criteria

- `new.test.ts` mock no longer includes `custom-commands`
- All existing tests pass
- Plan marker present in modified file

## Failure Recovery

If this phase fails:

1. `git checkout -- packages/cli/src/commands/extensions/new.test.ts`
2. Re-audit the test file for additional assertions that need updating

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P01.md`

---

# Phase P02: Delete Custom-Commands Example Files

## Phase ID

`PLAN-20250219-GMERGE021.R9.P02`

## Prerequisites

- Required: Phase P01 completed — test mock updated and passing
- Verification: `grep -r "@plan:PLAN-20250219-GMERGE021.R9.P01" packages/cli/src/commands/extensions/new.test.ts`

## Requirements Implemented (Expanded)

### REQ-GMERGE-R9-002: Remove custom-commands Example Subtree

**Full Text**: The entire `packages/cli/src/commands/extensions/examples/custom-commands/` directory subtree MUST be deleted, including all leaf files and now-empty parent directories.

**Behavior**:
- GIVEN: The `custom-commands/` example exists at the path above
- WHEN: The entire subtree is deleted
- THEN: `getBoilerplateChoices()` no longer includes `custom-commands` in its returned list (because it reads from disk dynamically via `readdir`)

**Why This Matters**: This is the primary implementation of the upstream removal. The dynamic `readdir` discovery in `new.ts` means no code edits are required — deleting the directory is the complete behavior change.

## Implementation Tasks

### Files to Delete

```
packages/cli/src/commands/extensions/examples/custom-commands/commands/fs/grep-code.toml
packages/cli/src/commands/extensions/examples/custom-commands/llxprt-extension.json
packages/cli/src/commands/extensions/examples/custom-commands/commands/fs/   (now empty)
packages/cli/src/commands/extensions/examples/custom-commands/commands/      (now empty)
packages/cli/src/commands/extensions/examples/custom-commands/               (now empty)
```

**Delete command:**
```bash
rm -rf packages/cli/src/commands/extensions/examples/custom-commands/
```

**Empty-directory handling:** All subdirectories under `custom-commands/` will be empty after removing the two files. The entire `custom-commands/` subtree must be deleted — not just the leaf files.

**Safety note:** No code in `new.ts` hardcodes this path; discovery is dynamic. The test mock was already updated in P01. This deletion is safe.

## Verification Commands

### Automated Checks

```bash
# Confirm directory no longer exists
ls packages/cli/src/commands/extensions/examples/custom-commands/ 2>&1
# Expected: "No such file or directory"

# Confirm remaining examples are intact
ls packages/cli/src/commands/extensions/examples/
# Expected: context  exclude-tools  mcp-server

# Confirm no TS source references custom-commands
grep -r "custom-commands" packages/cli/src/ --include="*.ts"
# Expected: no matches
```

### Structural Verification Checklist

- [ ] `custom-commands/` directory subtree fully deleted (no empty dirs remain)
- [ ] `context/`, `exclude-tools/`, `mcp-server/` examples still present
- [ ] No TypeScript source files reference `custom-commands`

### Deferred Implementation Detection

```bash
# Verify no orphaned references remain in source
grep -rn "custom-commands\|grep-code" packages/cli/src/ | grep -v ".test.ts"
# Expected: no matches
```

### Semantic Verification Checklist

1. **Does the code DO what the requirement says?**
   - [ ] Directory subtree deleted
   - [ ] `getBoilerplateChoices()` will no longer enumerate `custom-commands` at runtime

2. **Is this REAL implementation, not placeholder?**
   - [ ] Files physically deleted, not just commented out or renamed
   - [ ] No empty directories left behind

3. **Would the test FAIL if implementation was removed?**
   - [ ] After P01 updated the mock, the test suite correctly reflects the absent template
   - [ ] If `custom-commands/` were re-added to disk, integration behavior would surface the mismatch

4. **Is the feature REACHABLE by users?**
   - [ ] `llxprt extensions new <path>` command reads from disk at runtime — deletion takes effect immediately

5. **What's MISSING?**
   - [ ] Documentation still references `custom-commands` and `grep-code` — handled in P03

## Success Criteria

- `custom-commands/` subtree does not exist
- Remaining three examples (`context`, `exclude-tools`, `mcp-server`) are intact
- No TypeScript source references to `custom-commands`

## Failure Recovery

If this phase fails:

1. `git checkout -- packages/cli/src/commands/extensions/examples/custom-commands/`
2. Verify the files were restored
3. Re-examine why deletion failed before retrying

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P02.md`

---

# Phase P03: Update Documentation

## Phase ID

`PLAN-20250219-GMERGE021.R9.P03`

## Prerequisites

- Required: Phase P02 completed — `custom-commands/` subtree deleted
- Verification: `ls packages/cli/src/commands/extensions/examples/` (must not list `custom-commands`)

## Requirements Implemented (Expanded)

### REQ-GMERGE-R9-003: Update docs/cli/commands.md

**Full Text**: The grep-code example in `docs/cli/commands.md` (lines 235–258) MUST be updated to not imply the file ships with LLxprt, while retaining the pedagogical content about `{{args}}` shell-escape behavior.

**Behavior**:
- GIVEN: `docs/cli/commands.md` references `/grep-code.toml` as a shipped example file
- WHEN: The example header is changed from a file-path reference to a generic label, and the invocation example is updated to a generic name
- THEN: Docs no longer imply the file ships, but the shell-escape documentation is preserved

**Why This Matters**: The `{{args}}` shell-escape documentation is pedagogically valuable and must be retained. Simply removing the section would lose important user-facing guidance.

### REQ-GMERGE-R9-004: Update docs/extension.md Template List

**Full Text**: The template list at `docs/extension.md` line 129 MUST have `custom-commands` removed, leaving only `context`, `exclude-tools`, and `mcp-server`.

**Behavior**:
- GIVEN: `docs/extension.md:129` reads `` `context`, `custom-commands`, `exclude-tools`, and `mcp-server` ``
- WHEN: `custom-commands` is removed from the list
- THEN: The list reads `` `context`, `exclude-tools`, and `mcp-server` ``

**Why This Matters**: The docs must accurately reflect the available templates after this change.

## Implementation Tasks

### Files to Modify

**`docs/cli/commands.md` (lines 235–258):**
- Change `**Example (\`/grep-code.toml\`):**` → `**Example (custom command TOML):**`
- Change `When you run \`/grep-code It's complicated\`:` → `When you run \`/my-command It's complicated\`:`
- Keep all remaining explanation text intact — the shell-escape behavior documentation is correct and valuable
- ADD comment reference: `<!-- @plan:PLAN-20250219-GMERGE021.R9.P03 -->`

**`docs/extension.md` (line ~129):**
- Change: `` `context`, `custom-commands`, `exclude-tools`, and `mcp-server`. ``
- To: `` `context`, `exclude-tools`, and `mcp-server`. ``
- ADD comment reference: `<!-- @plan:PLAN-20250219-GMERGE021.R9.P03 -->`

## Verification Commands

### Automated Checks

```bash
# Confirm no grep-code or custom-commands references remain in docs
grep -rn "grep-code\|custom-commands" docs/
# Expected: no matches

# Confirm plan marker present in both docs files
grep "PLAN-20250219-GMERGE021.R9.P03" docs/cli/commands.md docs/extension.md
# Expected: 2 matches (one per file)

# Confirm extension.md still has three remaining templates
grep -A2 "context.*exclude-tools\|mcp-server" docs/extension.md
# Expected: line with context, exclude-tools, mcp-server — no custom-commands
```

### Structural Verification Checklist

- [ ] `docs/cli/commands.md` example header updated to generic label
- [ ] `docs/cli/commands.md` invocation example updated to generic name
- [ ] Shell-escape documentation content preserved intact
- [ ] `docs/extension.md` template list updated to three entries
- [ ] Plan markers added to both files

### Semantic Verification Checklist

1. **Does the code DO what the requirement says?**
   - [ ] `docs/cli/commands.md` no longer implies `grep-code.toml` ships with LLxprt
   - [ ] `docs/extension.md` template list is accurate

2. **Is this REAL implementation, not placeholder?**
   - [ ] Actual file content changed — not just a comment
   - [ ] `grep "grep-code" docs/` returns no matches

3. **Would the test FAIL if implementation was removed?**
   - [ ] Post-change grep scans in P04 will catch any regression

4. **Is the feature REACHABLE by users?**
   - [ ] Docs are user-facing — changes take effect on next docs publication

5. **What's MISSING?**
   - [ ] Comprehensive reference scan (handled in P04)

## Success Criteria

- Zero references to `grep-code` or `custom-commands` in `docs/`
- Shell-escape documentation preserved in `commands.md`
- Template list in `extension.md` reduced to three entries

## Failure Recovery

If this phase fails:

1. `git checkout -- docs/cli/commands.md docs/extension.md`
2. Re-read the section at lines 235–258 to identify the correct update

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P03.md`

---

# Phase P04: Comprehensive Reference Verification

## Phase ID

`PLAN-20250219-GMERGE021.R9.P04`

## Prerequisites

- Required: Phase P03 completed — all documentation updated
- Verification: `grep -rn "grep-code\|custom-commands" docs/` (must return no matches)

## Requirements Implemented (Expanded)

### REQ-GMERGE-R9-005: No Remaining Live References

**Full Text**: After all changes, ZERO references to `custom-commands` or `grep-code` MUST remain in any live file (TypeScript source, Markdown docs, JSON config, TOML, shell scripts, YAML workflows) — excluding `node_modules`, `.git`, and inert historical `project-plans/` files.

**Behavior**:
- GIVEN: All prior phases completed
- WHEN: A comprehensive grep scan is run
- THEN: No matches are found in any live file

**Why This Matters**: Stale references cause user confusion and broken documentation links.

## Implementation Tasks

### No New Code — Verification Only

This phase runs the post-deletion reference scan and resolves any remaining references found.

```bash
grep -r "custom-commands\|grep-code" . \
  --include="*.ts" --include="*.md" --include="*.json" \
  --include="*.toml" --include="*.sh" --include="*.yml" \
  | grep -v "node_modules\|.git\|project-plans\|tmp\|dist"
```

**Expected remaining references after all prior phases:** None.

If any are found, fix them before proceeding.

## Verification Commands

### Automated Checks (Structural)

```bash
# Comprehensive reference scan
grep -r "custom-commands\|grep-code" . \
  --include="*.ts" --include="*.md" --include="*.json" \
  --include="*.toml" --include="*.sh" --include="*.yml" \
  | grep -v "node_modules\|.git\|project-plans\|tmp\|dist"
# Expected: no output

# Docs link scan specifically
grep -r "grep-code\|custom-commands" docs/
# Expected: no matches

# Source scan specifically
grep -r "custom-commands" packages/cli/src/ --include="*.ts"
# Expected: no matches
```

### Structural Verification Checklist

- [ ] Comprehensive scan returns no matches
- [ ] Docs scan returns no matches
- [ ] Source scan returns no matches
- [ ] Build artifacts check: `ls packages/cli/dist/src/commands/extensions/examples/` shows only `context`, `exclude-tools`, `mcp-server`

### Semantic Verification Checklist

1. **Does the code DO what the requirement says?**
   - [ ] All references eliminated from live files
   - [ ] Historical references in `project-plans/` confirmed inert

2. **Is this REAL implementation, not placeholder?**
   - [ ] Scan actually run, not assumed
   - [ ] Any found references actually fixed (not deferred)

3. **Would the test FAIL if implementation was removed?**
   - [ ] Full verification suite in P05 will catch regressions

4. **Is the feature REACHABLE by users?**
   - [ ] N/A — this is a verification phase

## Success Criteria

- Comprehensive reference scan returns zero matches in live files
- Build dist artifacts do not include `custom-commands`

## Failure Recovery

If remaining references found:

1. Identify the file and location from grep output
2. Update or remove the reference
3. Re-run the comprehensive scan until clean

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P04.md`

---

# Phase P05: Full Verification Suite

## Phase ID

`PLAN-20250219-GMERGE021.R9.P05`

## Prerequisites

- Required: Phase P04 completed — comprehensive reference scan clean
- Verification: Scan from P04 returns no matches

## Requirements Implemented (Expanded)

### REQ-GMERGE-R9-006: Full LLxprt Verification Suite Passes

**Full Text**: All steps of the LLxprt project verification workflow MUST pass after all changes are applied.

**Behavior**:
- GIVEN: All prior phases completed
- WHEN: Full verification suite is run
- THEN: All commands exit 0 and the haiku smoke test succeeds

**Why This Matters**: This confirms no regressions were introduced and the project is in a releasable state.

## Implementation Tasks

### Verification Only — Fix Any Issues Found

Run each step in sequence. Fix issues before proceeding to the next step.

```bash
npm run format
npm run lint
npm run typecheck
npm run test
npm run build
node scripts/start.js --profile-load synthetic --prompt "write me a haiku"
```

### Targeted Behavioral Verification (Before Full Suite)

1. **Extension discovery smoke test** — verify CLI starts without error:
   ```bash
   node scripts/start.js --profile-load synthetic --prompt "write me a haiku"
   ```

2. **Template listing check** — confirm `custom-commands` no longer appears:
   ```bash
   # getBoilerplateChoices() reads from disk dynamically — deleting the directory is sufficient
   ls packages/cli/src/commands/extensions/examples/
   # Expected: context  exclude-tools  mcp-server
   ```

3. **Negative-path behavior** — after deletion, `llxprt extensions new /tmp/test-ext custom-commands` should fail with a clear error (yargs rejects invalid `choices` value built dynamically from disk).

4. **Build artifact inspection:**
   ```bash
   ls packages/cli/dist/src/commands/extensions/examples/
   # Expected: context  exclude-tools  mcp-server
   ```

## Verification Commands

### Automated Checks

```bash
# Full suite
npm run format && npm run lint && npm run typecheck && npm run test && npm run build
# Expected: all exit 0

# Smoke test
node scripts/start.js --profile-load synthetic --prompt "write me a haiku"
# Expected: produces a haiku, no errors

# Final reference scan
grep -r "custom-commands\|grep-code" . \
  --include="*.ts" --include="*.md" --include="*.json" \
  --include="*.toml" --include="*.sh" --include="*.yml" \
  | grep -v "node_modules\|.git\|project-plans\|tmp\|dist"
# Expected: no output

# Build artifacts
ls packages/cli/dist/src/commands/extensions/examples/
# Expected: context  exclude-tools  mcp-server
```

### Structural Verification Checklist

- [ ] `npm run format` exits 0
- [ ] `npm run lint` exits 0
- [ ] `npm run typecheck` exits 0
- [ ] `npm run test` exits 0 — including `new.test.ts`
- [ ] `npm run build` exits 0
- [ ] Haiku smoke test succeeds
- [ ] Build artifacts do not include `custom-commands`

### Deferred Implementation Detection (MANDATORY)

```bash
# Check for TODO/FIXME left behind
grep -rn -E "(TODO|FIXME|HACK|STUB|XXX|WIP)" \
  packages/cli/src/commands/extensions/new.test.ts \
  docs/cli/commands.md \
  docs/extension.md \
  | grep -v ".test.ts"
# Expected: no matches (or only pre-existing, unrelated ones)
```

### Semantic Verification Checklist

1. **Does the code DO what the requirement says?**
   - [ ] Full verification suite passes
   - [ ] `new.test.ts` passes with updated mock
   - [ ] CLI starts correctly without `custom-commands`

2. **Is this REAL implementation, not placeholder?**
   - [ ] All six verification steps actually run, not assumed
   - [ ] Haiku test actually produces output

3. **Would the test FAIL if implementation was removed?**
   - [ ] `new.test.ts` mock updated — if `custom-commands` were re-added to mock, test coverage would notice
   - [ ] Build would include `custom-commands` in dist if directory were re-added

4. **Is the feature REACHABLE by users?**
   - [ ] `llxprt extensions new` command no longer offers `custom-commands`
   - [ ] Docs no longer reference `grep-code.toml` as a shipped file

5. **What's MISSING?**
   - [ ] Changelog entry — see Notes below

#### Feature Actually Works

```bash
# Confirm template list excludes custom-commands
ls packages/cli/src/commands/extensions/examples/
# Expected behavior: shows context  exclude-tools  mcp-server
# Actual behavior: [paste what actually happens]
```

#### Integration Points Verified

- [ ] `new.ts` `getBoilerplateChoices()` reads from disk dynamically — confirmed by code review
- [ ] Deleting `custom-commands/` directory is the complete implementation for CLI behavior
- [ ] `new.test.ts` mock updated correctly — no remaining `custom-commands` assertions
- [ ] Docs updated — no remaining `grep-code` or `custom-commands` references

## Success Criteria

- All six verification commands exit 0
- Haiku smoke test succeeds
- Final reference scan returns zero matches
- Build dist artifacts exclude `custom-commands`

## Failure Recovery

If any step fails:

1. Address the specific failure (lint error, type error, test failure, etc.)
2. Re-run the full suite from the beginning
3. Do not commit until all six steps pass

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P05.md`

---

## Files to Modify — Summary

| File | Action | Phase | Notes |
|------|--------|-------|-------|
| `packages/cli/src/commands/extensions/examples/custom-commands/commands/fs/grep-code.toml` | Delete | P02 | |
| `packages/cli/src/commands/extensions/examples/custom-commands/llxprt-extension.json` | Delete | P02 | |
| `packages/cli/src/commands/extensions/examples/custom-commands/` (entire subtree) | Delete | P02 | All subdirs become empty |
| `packages/cli/src/commands/extensions/new.test.ts` | Update | P01 | Remove `custom-commands` from mock `fakeFiles` |
| `docs/cli/commands.md` | Update | P03 | Change example header/invocation to generic names; retain content |
| `docs/extension.md` | Update | P03 | Remove `custom-commands` from template list at line 129 |

---

## Dependency Verification Summary

| Potential Dependency | Status | Risk |
|----------------------|--------|------|
| `new.ts` uses dynamic `readdir` — no hardcoded `custom-commands` | Verified in P00.5 | None |
| Snapshot/golden tests for example enumeration | Test uses mocks, no filesystem snapshots | Low — mock updated in P01 |
| CI/script automation parsing example directories | No references in `.github/` or `scripts/` | None |
| Docs with cross-links/anchors to `custom-commands` | Two locations, both in scope (P03) | Handled |
| Changelog/release-note process | No automated changelog found | Low — manual note recommended |

---

## Notes

- The `context`, `exclude-tools`, and `mcp-server` examples are unaffected.
- The `new.ts` command's template validation is dynamic (built from filesystem at runtime), so deleting the directory is the complete implementation of the CLI behavior change — no code edits required there.
- The docs example in `commands.md` MUST be retained as inline instructional content (not a file reference), preserving its pedagogical value while removing the implication that the file ships.
- Add a changelog entry noting the `custom-commands` boilerplate template has been removed, directing users to `context`, `exclude-tools`, or `mcp-server` as alternatives.

---

## Execution Tracker

| Phase | ID | Status | Started | Completed | Verified | Semantic? | Notes |
|-------|-----|--------|---------|-----------|----------|-----------|-------|
| P00.5 | Preflight | ⬜ | - | - | - | N/A | Verify all assumptions |
| P01 | Test Update | ⬜ | - | - | - | ⬜ | TDD: update mock first |
| P02 | Delete Files | ⬜ | - | - | - | ⬜ | Remove custom-commands subtree |
| P03 | Update Docs | ⬜ | - | - | - | ⬜ | commands.md and extension.md |
| P04 | Ref Scan | ⬜ | - | - | - | ⬜ | Comprehensive reference check |
| P05 | Verification | ⬜ | - | - | - | ⬜ | Full suite + smoke test |

## Completion Markers

- [ ] All phases completed in sequence (P00.5 → P01 → P02 → P03 → P04 → P05)
- [ ] All `@plan:PLAN-20250219-GMERGE021.R9.*` markers present in modified files
- [ ] Verification suite passes (all six commands exit 0)
- [ ] Haiku smoke test succeeds
- [ ] No remaining `custom-commands` or `grep-code` references in live files
