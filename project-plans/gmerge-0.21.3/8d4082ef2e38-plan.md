# Plan: Hook System Documentation Merge

Plan ID: `PLAN-20250219-GMERGE021.R6`
Generated: 2026-02-19
Total Phases: 6 (P00.5, P01–P05)
Upstream Commit: `8d4082ef2e38` — Hook System Documentation (Edilmo Palencia)

## Critical Reminders

Before implementing ANY phase, ensure you have:

1. Completed preflight verification (Phase P00.5)
2. Verified all hook events exist in code before documenting them
3. Confirmed R5 (`b8c038f41f82`) status before writing `/hooks panel` docs
4. Resolved the `continue` vs `decision` output format inconsistency before adding new content

---

## Execution Tracker

| Phase | ID | Status | Started | Completed | Verified | Semantic? | Notes |
|-------|----|--------|---------|-----------|----------|-----------|-------|
| 0.5 | P00.5 | ⬜ | - | - | - | N/A | Preflight verification |
| 01 | P01 | ⬜ | - | - | - | ⬜ | Fix output format inconsistency |
| 02 | P02 | ⬜ | - | - | - | ⬜ | Create best-practices doc |
| 03 | P03 | ⬜ | - | - | - | ⬜ | Enhance index document |
| 04 | P04 | ⬜ | - | - | - | ⬜ | Add missing events to API reference |
| 05 | P05 | ⬜ | - | - | - | ⬜ | Update sidebar and main index |

---

# Phase P00.5: Preflight Verification

## Phase ID

`PLAN-20250219-GMERGE021.R6.P00.5`

## Purpose

Verify ALL assumptions before writing any documentation. This is a documentation-only merge, but the docs must accurately reflect the actual implementation.

## Dependency Verification

| Dependency | Check Command | Status |
|------------|---------------|--------|
| `HookEventName.PreCompress` | `grep -r "PreCompress" packages/core/src/hooks/` | PENDING |
| `HookEventName.Notification` | `grep -r "Notification" packages/core/src/hooks/` | PENDING |
| Session trigger types (`resume`, `clear`) | `grep -r "resume\|clear" packages/core/src/hooks/` | PENDING |
| R5 `/hooks panel` command | Check if `b8c038f41f82` batch is merged | PENDING |
| `docs/sidebar.json` structure | `cat docs/sidebar.json` | PENDING |

## Event/Type Verification

| Event/Type | Expected in Code | Actual (grep output) | Documented? |
|------------|-----------------|----------------------|-------------|
| `PreCompress` | `HookEventName.PreCompress` | PENDING | NO |
| `Notification` | `HookEventName.Notification` | PENDING | NO |
| Session `trigger: 'startup'` | In session hook input | PENDING | NO |
| Session `trigger: 'resume'` | In session hook input | PENDING | NO |
| Session `trigger: 'clear'` | In session hook input | PENDING | NO |
| `/hooks panel` command | CLI command handler | PENDING | NO |

## Current File State Verification

Before modifying any file, read it to confirm actual current state:

| File | Action | Verified? |
|------|--------|-----------|
| `docs/hooks/index.md` | Read full file, note event table rows and any `continue:` patterns | ⬜ |
| `docs/hooks/creating-custom-hooks.md` | Read for `continue: true/false` patterns | ⬜ |
| `docs/hooks/api-reference.md` | Read for `HookDecision` type definition | ⬜ |
| `docs/hooks/best-practices.md` | Confirm does NOT exist yet | ⬜ |
| `docs/sidebar.json` | Read full structure | ⬜ |
| `docs/index.md` | Check hooks section | ⬜ |

## Tool Name Mapping (Verified Reference)

All documentation examples must use LLxprt snake_case tool names:

| LLxprt (use this) | Upstream/Gemini (do NOT use) |
|--------------------|------------------------------|
| `write_file` | `WriteFile` |
| `read_file` | `ReadFile` |
| `run_shell_command` | `RunShellCommand` |
| `edit` | `Edit` |
| `list_directory` | `ListDirectory` |
| `search_file_content` | `Search` |

## Configuration Path Mapping (Verified Reference)

| LLxprt (use this) | Upstream (do NOT use) |
|--------------------|-----------------------|
| `.llxprt/settings.json` | `.gemini/settings.json` |
| `.llxprt/hooks/` | `.gemini/hooks/` |
| `$LLXPRT_PROJECT_DIR` | `$GEMINI_PROJECT_DIR` |
| `~/.llxprt/` | `~/.gemini/` |
| `llxprt` command | `gemini` command |

## Verification Gate

- [ ] `HookEventName.PreCompress` confirmed present OR absent in code
- [ ] `HookEventName.Notification` confirmed present OR absent in code
- [ ] Session trigger types confirmed present OR absent
- [ ] R5 `/hooks panel` status confirmed (complete or pending)
- [ ] `docs/hooks/best-practices.md` confirmed to not exist yet
- [ ] `docs/sidebar.json` current structure read and understood

**IF ANY CHECKBOX IS UNCHECKED: STOP and resolve before proceeding to P01.**

## Blocking Issues Found

> [Fill in during execution — list any issues discovered that block proceeding]

---

# Phase P01: Fix Output Format Inconsistency

## Phase ID

`PLAN-20250219-GMERGE021.R6.P01`

## Prerequisites

- Required: Phase P00.5 completed and all checkboxes verified
- Verification: Preflight gate passed (all six checkboxes checked)
- Priority: **HIGH — must complete before adding any new content**

## Requirements Implemented

### REQ-R6-001: Standardize Hook Output Format in Documentation

**Full Text**: All user-facing documentation examples must use `decision: "allow"/"deny"/"block"` consistently. The `continue: true/false` pattern must not appear in example code blocks.

**Behavior**:
- GIVEN: A user reads any hook documentation example
- WHEN: They copy the JSON output pattern from the example
- THEN: The pattern uses `decision` field, matching the `HookDecision` TypeScript type

**Why This Matters**: Users copying `continue: true` from docs will produce hooks that behave unexpectedly because `HookDecision` uses `decision`, not `continue`. Inconsistency causes silent failures.

## Implementation Tasks

### Files to Modify

- `docs/hooks/index.md`
  - Find all `{"continue": true}` example patterns → replace with `{"decision": "allow"}`
  - Find all `{"continue": false, ...}` patterns → replace with `{"decision": "deny", ...}`
  - Do NOT touch TypeScript interface definitions — only JSON example blocks in prose
  - Implements: `@requirement:REQ-R6-001`

- `docs/hooks/creating-custom-hooks.md`
  - Same find-and-replace as above
  - Do NOT change the TypeScript `HookOutput` interface definitions
  - Implements: `@requirement:REQ-R6-001`

- `docs/hooks/api-reference.md`
  - Verify `HookDecision` type is defined as `'ask' | 'block' | 'deny' | 'approve' | 'allow'`
  - Keep `continue` documented as implementation detail field (do NOT remove from interface docs)
  - Only update any example code blocks that use `continue: true/false`
  - Implements: `@requirement:REQ-R6-001`

### Replacement Patterns

Replace:
```json
{"continue": true}
{"continue": false, "reason": "..."}
```

With:
```json
{"decision": "allow"}
{"decision": "deny", "reason": "..."}
```

For hard-stop security blocks, use:
```json
{"decision": "block", "reason": "..."}
```

## Verification Commands

```bash
# Check no continue: true/false remain in example blocks
grep -n '"continue"' docs/hooks/index.md docs/hooks/creating-custom-hooks.md
# Expected: 0 matches in example code blocks
# (OK if it appears in api-reference.md under interface docs as a field name)

# Verify decision pattern is present
grep -c '"decision"' docs/hooks/index.md
# Expected: 1+ matches

grep -c '"decision"' docs/hooks/creating-custom-hooks.md
# Expected: 1+ matches

# Branding check — no new Gemini references introduced
grep -n "gemini\|Gemini\|GEMINI" docs/hooks/index.md docs/hooks/creating-custom-hooks.md
# Expected: Only pre-existing migration-comparison rows (if any)
```

### Semantic Verification Checklist

- [ ] I read every example code block in `docs/hooks/index.md` and confirmed `continue:` is gone
- [ ] I read every example code block in `docs/hooks/creating-custom-hooks.md` and confirmed `continue:` is gone
- [ ] The `HookDecision` TypeScript interface still shows valid values (`allow`, `deny`, `block`, `ask`, `approve`)
- [ ] No TypeScript interface definitions were modified (only JSON example blocks)
- [ ] The `continue` field still appears in the API reference as a documented field of `HookOutput`

## Success Criteria

- Zero occurrences of `"continue": true` or `"continue": false` in example code blocks across `index.md` and `creating-custom-hooks.md`
- `"decision"` pattern used in all hook output examples
- API reference `HookDecision` type definition unchanged and correct

## Failure Recovery

If this phase produces errors:

1. `git checkout -- docs/hooks/index.md`
2. `git checkout -- docs/hooks/creating-custom-hooks.md`
3. `git checkout -- docs/hooks/api-reference.md`
4. Re-read files and re-apply with more careful targeting

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P01.md`

```markdown
Phase: P01
Completed: YYYY-MM-DD HH:MM
Files Modified: docs/hooks/index.md, docs/hooks/creating-custom-hooks.md (+ api-reference.md if needed)
Changes: Replaced continue:true/false with decision:allow/deny patterns
Verification: [paste grep output showing 0 continue: matches]
```

---

# Phase P02: Create Best Practices Document

## Phase ID

`PLAN-20250219-GMERGE021.R6.P02`

## Prerequisites

- Required: Phase P01 completed
- Verification: `grep -n '"continue"' docs/hooks/index.md docs/hooks/creating-custom-hooks.md` returns no example-block matches
- Expected from P01: All example output patterns use `decision` field

## Requirements Implemented

### REQ-R6-002: Best Practices Documentation

**Full Text**: LLxprt must have a dedicated `docs/hooks/best-practices.md` document covering security, performance, debugging, and development workflow guidance for hook authors. Content adapted from upstream `best-practices.md` with LLxprt-specific paths, tool names, and command references.

**Behavior**:
- GIVEN: A developer is writing a hook script for LLxprt
- WHEN: They consult `docs/hooks/best-practices.md`
- THEN: They find actionable guidance on security, performance, debugging, and troubleshooting that uses correct LLxprt paths and tool names

**Why This Matters**: Without consolidated best practices, hook authors make common mistakes (logging to stdout, storing secrets in scripts, writing slow hooks) that degrade the experience or create security issues.

## Implementation Tasks

### Files to Create

- `docs/hooks/best-practices.md`
  - Adapted from upstream `best-practices.md` (806 lines)
  - MUST use `$LLXPRT_PROJECT_DIR`, `~/.llxprt/`, `llxprt` command throughout
  - MUST use snake_case tool names (`write_file`, `read_file`, etc.)
  - MUST NOT include `gemini hooks migrate --from-claude` command
  - MUST NOT reference Gemini UI or Gemini telemetry

### Required Sections

**Security Section**:
- Validate all inputs before acting on them
- Use timeouts (never block indefinitely)
- Avoid storing secrets in hook scripts; use environment variables
- Scan outputs for sensitive data before logging
- Apply principle of least privilege for hook scripts

**Performance Section**:
- Use matchers to narrow event scope
- Prefer parallel hooks over sequential where order doesn't matter
- Cache expensive lookups across invocations
- Keep hook startup time minimal (avoid slow imports at module level)

**Debugging Section**:
- Log to `stderr` — not `stdout` (stdout is the hook protocol channel)
- Use `/hooks` panel to inspect hook status (add `<!-- TODO: Requires R5 -->` if R5 not complete)
- Test hooks standalone before wiring to LLxprt
- Use `--debug` flag to see hook invocation logs

**Development Workflow Section**:
- Start with `exit 0` + `{"decision": "allow"}` and iterate
- Use a JSON library rather than string concatenation for hook output
- Make scripts executable (`chmod +x`)
- Keep hooks in version control alongside project code

**Troubleshooting Section**:

| Symptom | Cause | Fix |
|---------|-------|-----|
| Hook not firing | `enableHooks: false` in settings | Set `enableHooks: true` in `.llxprt/settings.json` |
| Hook timing out | Slow operation or deadlock | Check timeout value (default 60s); add timeout handling |
| Permission denied | Script not executable | Run `chmod +x` on hook script |
| Unexpected blocking | Exit code / output mismatch | Check exit code semantics; non-zero exit = hook failure |

**Privacy Section**:
- Hook scripts receive full tool inputs — treat as sensitive data
- Avoid logging complete request payloads to shared or persistent logs
- Use environment variable filtering for any sensitive fields

## Adaptations Required (Checklist)

- [ ] All `$GEMINI_PROJECT_DIR` → `$LLXPRT_PROJECT_DIR`
- [ ] All `~/.gemini/` → `~/.llxprt/`
- [ ] All `.gemini/` → `.llxprt/`
- [ ] All PascalCase tool names → snake_case equivalents
- [ ] All `gemini` command references → `llxprt`
- [ ] Gemini-specific UI references removed
- [ ] Gemini telemetry references removed
- [ ] `gemini hooks migrate --from-claude` command removed
- [ ] `/hooks panel` section conditionally included based on R5 status (see P00.5)

## Verification Commands

```bash
# Confirm file was created
ls -la docs/hooks/best-practices.md
# Expected: File exists

# Branding check — no Gemini references
grep -i "gemini" docs/hooks/best-practices.md
# Expected: 0 matches

# Check LLxprt paths are used
grep -c "llxprt" docs/hooks/best-practices.md
# Expected: Several matches

# Check snake_case tool names
grep -E "\bWriteFile\b|\bReadFile\b|\bRunShellCommand\b|\bListDirectory\b" docs/hooks/best-practices.md
# Expected: 0 matches

# Confirm no migrate command
grep "migrate" docs/hooks/best-practices.md
# Expected: 0 matches

# Check decision pattern (not continue)
grep '"continue"' docs/hooks/best-practices.md
# Expected: 0 matches in example blocks
```

### Semantic Verification Checklist

- [ ] File `docs/hooks/best-practices.md` exists and is non-empty
- [ ] All six required sections are present (Security, Performance, Debugging, Dev Workflow, Troubleshooting, Privacy)
- [ ] No Gemini-specific content remains after adaptation
- [ ] All example paths use `.llxprt/` not `.gemini/`
- [ ] All tool examples use snake_case names
- [ ] If R5 not complete: `/hooks panel` reference has `<!-- TODO: Requires R5 -->` comment
- [ ] Troubleshooting table is present and accurate

## Success Criteria

- `docs/hooks/best-practices.md` exists with all six sections
- Zero Gemini references
- All example output patterns use `decision` not `continue`
- Troubleshooting table matches known LLxprt defaults (e.g., 60s timeout)

## Failure Recovery

If this phase produces errors:

1. `git checkout -- docs/hooks/best-practices.md` (or `rm` if newly created)
2. Review P00.5 preflight — re-verify tool name and path mappings
3. Re-create file with corrected content

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P02.md`

```markdown
Phase: P02
Completed: YYYY-MM-DD HH:MM
Files Created: docs/hooks/best-practices.md ([N] lines)
Verification: [paste grep outputs for branding and path checks]
```

---

# Phase P03: Enhance Index Document

## Phase ID

`PLAN-20250219-GMERGE021.R6.P03`

## Prerequisites

- Required: Phase P02 completed
- Verification: `ls docs/hooks/best-practices.md` succeeds
- Expected from P02: `docs/hooks/best-practices.md` exists and passes branding check

## Requirements Implemented

### REQ-R6-003: Index Event Table Completeness

**Full Text**: The `docs/hooks/index.md` event table must list all hook events that are implemented in the codebase. Events confirmed present in P00.5 (`PreCompress`, `Notification`) must be added. Events not present in code must NOT be added.

**Behavior**:
- GIVEN: A developer reads the hooks index
- WHEN: They look at the event table
- THEN: Every event listed exists in the codebase and every implemented event is listed

**Why This Matters**: Missing events means developers don't know capabilities exist; phantom events means they write hooks that never fire.

### REQ-R6-004: Configuration Precedence Documentation

**Full Text**: `docs/hooks/index.md` must document the configuration precedence order: System-level → User-level → Project-level.

**Behavior**:
- GIVEN: A developer configures hooks at both user and project level
- WHEN: They read the docs to understand which takes effect
- THEN: The index clearly shows project-level overrides user-level overrides system-level

**Why This Matters**: Without this, developers can't predict which configuration wins when hooks are set at multiple levels.

### REQ-R6-005: Session Trigger Types Documentation

**Full Text**: If session trigger subtypes (`startup`, `resume`, `clear`) are confirmed in code during P00.5, `SessionStart` and `SessionEnd` rows in the event table must document the `trigger` field values.

**Behavior**:
- GIVEN: A developer writes a `SessionStart` hook
- WHEN: They want to fire it only on fresh sessions, not `/clear`
- THEN: The docs show how to check `trigger === 'startup'` vs `'clear'`

**Why This Matters**: Without trigger type docs, session hooks cannot be targeted to specific session lifecycle events.

## Implementation Tasks

### Files to Modify

- `docs/hooks/index.md`
  - **Event table expansion** (conditional on P00.5 verification):
    - If `HookEventName.PreCompress` confirmed in code: add `PreCompress` row with `trigger: 'manual' | 'auto'` input description
    - If `HookEventName.Notification` confirmed in code: add `Notification` row with observation-only note
    - Do NOT add events not confirmed by P00.5 grep
  - **Configuration precedence section** (new section, add after quick-start):
    - System-level: `/etc/llxprt/settings.json` (only if confirmed to exist in code — P00.5)
    - User-level: `~/.llxprt/settings.json`
    - Project-level: `.llxprt/settings.json`
  - **Session trigger types** (conditional on P00.5 verification):
    - Add `trigger` field documentation to `SessionStart`/`SessionEnd` table rows
    - Only document trigger values confirmed present in code
  - **`/hooks` panel reference** (conditional on R5 status from P00.5):
    - If R5 complete: add full `/hooks panel` command documentation
    - If R5 pending: add `<!-- TODO: Requires R5 (b8c038f41f82) -->` placeholder
  - **Keep unchanged**:
    - Existing Claude Code migration section
    - Existing Gemini CLI migration section (contrast table)
    - All existing event rows — do not remove or reorder

## Verification Commands

```bash
# Count event table rows
grep -c "^|" docs/hooks/index.md
# Expected: More rows than before (if events were added)

# Verify no phantom events (cross-check with code)
# For each event added, confirm:
grep -r "PreCompress" packages/core/src/hooks/  # (if you added PreCompress)
grep -r "Notification" packages/core/src/hooks/ # (if you added Notification)

# Verify configuration precedence section exists
grep -n "precedence\|Precedence\|System.*User.*Project\|/etc/llxprt" docs/hooks/index.md
# Expected: 1+ matches

# Branding check
grep -i "gemini" docs/hooks/index.md | grep -v "migration\|Gemini CLI\|Claude Code"
# Expected: 0 matches (only migration contrast table entries are OK)

# Verify existing migration sections still present
grep -c "Claude Code\|Gemini CLI" docs/hooks/index.md
# Expected: Same count as before (or more)
```

### Semantic Verification Checklist

- [ ] Every event added to the table was confirmed present in code during P00.5
- [ ] No events added that were NOT confirmed in code
- [ ] Configuration precedence section is present and accurate
- [ ] Session trigger types documented only for confirmed triggers
- [ ] `/hooks panel` section either complete (R5 done) or has TODO placeholder (R5 pending)
- [ ] Claude Code migration section still present and unchanged
- [ ] Gemini CLI migration section still present and unchanged

## Success Criteria

- Event table reflects actual implemented events (no phantom events, no missing confirmed events)
- Configuration precedence section exists
- Session trigger documentation matches what P00.5 confirmed in code
- Existing migration content preserved

## Failure Recovery

If this phase produces errors:

1. `git checkout -- docs/hooks/index.md`
2. Re-read P00.5 results to re-verify which events exist
3. Re-apply only changes that are confirmed by grep evidence

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P03.md`

```markdown
Phase: P03
Completed: YYYY-MM-DD HH:MM
Files Modified: docs/hooks/index.md
Events Added: [list confirmed events added, or "none confirmed"]
Sections Added: Configuration Precedence, [Session Triggers if applicable], [/hooks panel if R5 complete]
Verification: [paste grep outputs]
```

---

# Phase P04: Add Missing Events to API Reference

## Phase ID

`PLAN-20250219-GMERGE021.R6.P04`

## Prerequisites

- Required: Phase P03 completed
- Verification: Configuration precedence section exists in `docs/hooks/index.md`
- Expected from P03: Event table updated with any confirmed-present events

## Requirements Implemented

### REQ-R6-006: API Reference Completeness for New Events

**Full Text**: For every event added to the index event table in P03, `docs/hooks/api-reference.md` must have a corresponding entry documenting the full input/output TypeScript interface.

**Behavior**:
- GIVEN: A developer finds `PreCompress` or `Notification` in the index event table
- WHEN: They follow the link to the API reference
- THEN: They find the complete TypeScript input/output interface for that event

**Why This Matters**: Listing an event in the index without API reference documentation is incomplete — developers cannot write hooks without knowing the input shape.

### REQ-R6-007: Session Trigger Field in API Reference

**Full Text**: If session trigger types were documented in P03, the `SessionStartInput` and `SessionEndInput` interfaces in `docs/hooks/api-reference.md` must include the `trigger` field with its union type.

**Behavior**:
- GIVEN: A developer reads the `SessionStartInput` interface
- WHEN: They look at available input fields
- THEN: They see `trigger: 'startup' | 'resume' | 'clear'` (or whichever subset is confirmed)

**Why This Matters**: Without the `trigger` field in the interface docs, developers can't write trigger-aware session hooks.

## Implementation Tasks

### Files to Modify

- `docs/hooks/api-reference.md`
  - **PreCompress event** (conditional — only if confirmed in P00.5 AND added in P03):
    ```typescript
    // Verify against actual implementation before writing:
    interface PreCompressInput {
      trigger: 'manual' | 'auto';
      session_id: string;
      message_count: number;
      estimated_tokens: number;
    }
    interface PreCompressOutput {
      decision: 'allow' | 'deny';
      reason?: string;
    }
    ```
  - **Notification event** (conditional — only if confirmed in P00.5 AND added in P03):
    ```typescript
    // Verify against actual implementation before writing:
    interface NotificationInput {
      event_type: 'ToolPermission' | string;
      tool_name?: string;
      message: string;
    }
    // Observation only — hooks cannot block notifications
    interface NotificationOutput {
      decision: 'allow';
    }
    ```
  - **Session trigger field** (conditional — only if documented in P03):
    - Add `trigger: 'startup' | 'resume' | 'clear'` to `SessionStartInput` interface
    - Add same to `SessionEndInput` interface
    - Only include trigger values confirmed in code by P00.5

  - **Preserve unchanged**:
    - All existing `DefaultHookOutput`, `BeforeToolHookOutput` and output class docs
    - All aggregation strategy documentation
    - All MessageBus integration docs
    - All LLxprt-specific architecture notes
    - Exit code semantics section

### Verification Before Writing

Before adding any interface definition, grep the actual implementation:

```bash
# For PreCompress — verify field names
grep -A 20 "PreCompress" packages/core/src/hooks/hook-types.ts

# For Notification — verify field names
grep -A 20 "Notification" packages/core/src/hooks/hook-types.ts

# For session triggers
grep -A 10 "SessionStart\|SessionEnd" packages/core/src/hooks/hook-types.ts
```

The interface documented MUST match what the grep shows. If grep returns nothing, do NOT add the interface.

## Verification Commands

```bash
# Confirm existing LLxprt-specific sections preserved
grep -c "DefaultHookOutput\|BeforeToolHookOutput\|MessageBus\|aggregation" docs/hooks/api-reference.md
# Expected: Same count as before P04 (or more)

# Verify decision pattern in new interfaces (not continue)
grep -n '"continue"' docs/hooks/api-reference.md
# Expected: Only in the HookOutput interface field doc, not in new event interfaces

# If PreCompress added — verify fields match code
grep "PreCompressInput\|PreCompressOutput" docs/hooks/api-reference.md
# Expected: Present if and only if P00.5 confirmed PreCompress in code

# Branding check
grep -i "gemini" docs/hooks/api-reference.md
# Expected: 0 new Gemini references (pre-existing ones from before this plan are OK if reviewed)
```

### Semantic Verification Checklist

- [ ] Every interface added was verified against actual code (grep evidence from P00.5)
- [ ] No interface added for events not confirmed present in code
- [ ] All pre-existing LLxprt-specific sections still present and unchanged
- [ ] Session trigger field type matches what grep of hook-types.ts shows
- [ ] All new interface examples use `decision` field (not `continue`)
- [ ] Aggregation strategy docs unmodified

## Success Criteria

- API reference has entries for all events listed in the P03 index table
- All interface definitions match actual code (verified by grep)
- Zero existing LLxprt-specific documentation removed

## Failure Recovery

If this phase produces errors:

1. `git checkout -- docs/hooks/api-reference.md`
2. Re-run implementation grepping against actual hook-types files
3. Only add interfaces that have grep evidence

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P04.md`

```markdown
Phase: P04
Completed: YYYY-MM-DD HH:MM
Files Modified: docs/hooks/api-reference.md
Events Added to API Ref: [list or "none"]
Grep Evidence: [paste relevant grep outputs from hook-types.ts]
Preservation Check: [paste grep count for DefaultHookOutput/MessageBus]
```

---

# Phase P05: Update Sidebar and Main Index

## Phase ID

`PLAN-20250219-GMERGE021.R6.P05`

## Prerequisites

- Required: Phase P04 completed
- Verification: API reference updated (or confirmed no-op if no events confirmed in code)
- Expected from P04: `docs/hooks/api-reference.md` consistent with index event table

## Requirements Implemented

### REQ-R6-008: Sidebar Navigation Updated

**Full Text**: `docs/sidebar.json` must include `best-practices.md` in the hooks section, since the file was created in P02.

**Behavior**:
- GIVEN: A user navigates the LLxprt docs sidebar
- WHEN: They expand the Hooks section
- THEN: They see "Best Practices" as a navigation item

**Why This Matters**: A document that isn't in the sidebar is effectively invisible to most users.

### REQ-R6-009: Main Index Links All Hook Documents

**Full Text**: `docs/index.md` must link to all 5 hook documents: `index.md`, `creating-custom-hooks.md`, `architecture.md`, `api-reference.md`, and `best-practices.md`.

**Behavior**:
- GIVEN: A developer lands on the docs index
- WHEN: They look at the Hooks section
- THEN: They can reach all 5 hook documentation files from that section

**Why This Matters**: Without a link in the main index, `best-practices.md` is orphaned.

## Implementation Tasks

### Files to Modify

- `docs/sidebar.json`
  - Read current structure first (P00.5 should have noted it)
  - Add `best-practices.md` entry to the hooks section
  - Match existing entry format exactly (do not change surrounding entries)

- `docs/index.md`
  - Read current hooks section
  - Add link to `docs/hooks/best-practices.md` if not already present
  - Keep all existing links unchanged

## Verification Commands

```bash
# Verify best-practices.md in sidebar
grep "best-practices" docs/sidebar.json
# Expected: 1 match

# Verify valid JSON after edit
node -e "require('./docs/sidebar.json'); console.log('valid JSON')"
# Expected: "valid JSON"

# Verify docs/index.md links to best-practices
grep "best-practices" docs/index.md
# Expected: 1 match

# Verify all 5 hook docs linked in index
grep -E "hooks/(index|creating-custom-hooks|architecture|api-reference|best-practices)" docs/index.md | wc -l
# Expected: 5

# Build check
npm run build
# Expected: Exit 0

# Full branding check across all modified docs
grep -r -i "gemini\|GEMINI" docs/hooks/ | grep -v "migration\|Gemini CLI comparison\|Claude Code"
# Expected: 0 matches in non-migration contexts
```

### Semantic Verification Checklist

- [ ] `docs/sidebar.json` is valid JSON after modification (node parse check passes)
- [ ] `best-practices.md` appears in sidebar hooks section
- [ ] `docs/index.md` has links to all 5 hook documents
- [ ] `npm run build` passes
- [ ] No Gemini references introduced in any file modified by this plan
- [ ] Cross-document links in `best-practices.md` resolve to real files

#### Cross-Document Link Verification

- [ ] Links from `best-practices.md` to `index.md` resolve
- [ ] Links from `best-practices.md` to `api-reference.md` resolve
- [ ] Links from `index.md` to `best-practices.md` resolve
- [ ] Sidebar entry for `best-practices.md` matches actual filename

## Success Criteria

- `docs/sidebar.json` valid JSON with `best-practices.md` in hooks section
- `docs/index.md` links all 5 hook documents
- `npm run build` exits 0
- Complete branding scan returns zero Gemini references in non-migration doc contexts

## Failure Recovery

If this phase produces errors:

1. `git checkout -- docs/sidebar.json` (if JSON became invalid)
2. `git checkout -- docs/index.md`
3. Re-read current file structure, then re-apply minimal targeted edits

## Phase Completion Marker

Create: `project-plans/gmerge-0.21.3/.completed/P05.md`

```markdown
Phase: P05
Completed: YYYY-MM-DD HH:MM
Files Modified: docs/sidebar.json, docs/index.md
Sidebar Valid JSON: YES
Build: PASS / FAIL
Branding Scan: [paste output]
All 5 hooks docs linked: YES/NO
```

---

## Gap Analysis Reference

### What Upstream Has That LLxprt Lacks (This Plan Addresses)

| Category | Upstream | LLxprt Before | Gap | Phase | Priority |
|----------|----------|---------------|-----|-------|----------|
| **Best Practices** | Dedicated doc | Scattered | Create `best-practices.md` | P02 | **HIGH** |
| **PreCompress Event** | Full spec | Missing | Add (if in code) | P03/P04 | **HIGH** |
| **Notification Event** | Full spec | Missing | Add (if in code) | P03/P04 | **MEDIUM** |
| **Session Trigger Types** | `startup`, `resume`, `clear` | Not documented | Add (if in code) | P03/P04 | **HIGH** |
| **Config Precedence** | System → User → Project | Not documented | Add to index | P03 | **MEDIUM** |
| **Output Format Consistency** | Uniform `decision` | Mixed `continue`/`decision` | Fix inconsistency | P01 | **HIGH** |
| **Sidebar navigation** | Hooks section | Needs verification | Add best-practices entry | P05 | **LOW** |

### What LLxprt Has That Upstream Lacks (Preserve — Do NOT Remove)

| Category | LLxprt | Upstream |
|----------|--------|----------|
| **API Reference** | Complete TypeScript output class interfaces | Partial |
| **Architecture Docs** | Component diagram, execution flow | None |
| **Hook Output Classes** | `DefaultHookOutput`, `BeforeToolHookOutput`, etc. | None |
| **MessageBus Integration** | Internal bus contracts, aggregation | Basic |
| **Aggregation Strategies** | OR logic, field replacement, tool selection | None |
| **Exit Code Semantics** | Plain text fallback behavior | None |
| **Migration from Claude Code** | In `index.md` | Absent |

---

## Risk Assessment

| Risk | Impact | Mitigation | Phase |
|------|--------|------------|-------|
| Documenting non-existent events | HIGH — docs diverge from code | P00.5 dependency check | P00.5 |
| Output format inconsistency worsens | HIGH — user confusion | P01 must run before P02+ | P01 |
| R5 `/hooks panel` not done | MEDIUM — phantom feature docs | Conditional placeholder | P00.5, P03 |
| Tool names use wrong case | MEDIUM — users copy and fail | Adaptation checklist in P02 | P02 |
| Upstream Gemini-specific content leaks in | MEDIUM — confuses LLxprt users | Per-phase branding checks | All |
| Session trigger types not in code | MEDIUM — docs lie | P00.5 grep gates P03 add | P00.5, P03 |
| `docs/sidebar.json` invalid JSON after edit | LOW — build breaks | Validate with `node -e` | P05 |
| LLxprt-specific API ref content removed | HIGH — regressions | Explicit "preserve" lists in P04 | P04 |

---

## Resolved Questions

1. **Output Format:** Standardize on `decision: "allow"/"deny"/"block"` in all examples. `continue` stays in API reference as implementation detail field only. → Resolved, implemented in P01.

2. **Event Naming:** Upstream uses PascalCase events (`BeforeTool`) — LLxprt uses same. No change needed.

3. **Configuration Location:** Do NOT add `/etc/llxprt/settings.json` to docs unless P00.5 grep confirms it exists in the codebase.

4. **Migration Command:** Do NOT document `llxprt hooks migrate --from-claude` — LLxprt has no such command. The conceptual migration guide in `index.md` is sufficient.

5. **Scope:** This plan is documentation-only. No code changes required. The `continue` vs `decision` fix is a doc example correction, not an API change.

---

## Estimated Effort

| Phase | Task | Estimate |
|-------|------|----------|
| P00.5 | Preflight verification | 30 min |
| P01 | Output format fix | 30 min |
| P02 | Create best-practices.md | 2–3 hours |
| P03 | Enhance index.md | 1 hour |
| P04 | Enhance api-reference.md | 1–2 hours |
| P05 | Sidebar and main index | 30 min |
| **Total** | | **~5–7 hours** |
