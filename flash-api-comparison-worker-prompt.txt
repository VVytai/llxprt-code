URGENT: Compare API Calls Between First and Subsequent Flash Messages

CONTEXT:
- Flash ignores first ~5 prompts, then works perfectly
- This suggests the API request structure changes
- Need to find EXACT differences in API calls

YOUR TASK: Analyze and compare API request construction

INVESTIGATION AREAS:

1. Find where API requests are built:
   - packages/cli/src/providers/gemini/GeminiProvider.ts
   - packages/core/src/core/geminiChat.ts
   - Look for generateResponse, sendMessage, or similar
   - Find actual API call construction

2. Compare these specific elements:
   - Request body structure
   - Tool schemas inclusion
   - System messages
   - Message history format
   - Model parameters
   - Headers or auth

3. Look for:
   - Conditional logic based on conversation state
   - Different request format for first message
   - Tool schema inclusion timing
   - System prompt differences
   - Message accumulation effects

4. Analyze:
   - What's in the first API call that fails
   - What's in the ~5th call that succeeds
   - What accumulated or changed between them
   - Any state flags that affect request

5. Check for:
   - Missing tools in first request
   - Different message format initially
   - System message not included
   - Conversation context differences
   - Any "activation" parameters

6. Document the EXACT structure:
   ```
   First API call:
   {
     model: "gemini-2.5-flash-exp",
     messages: [...],
     tools: [...], // or missing?
     ...
   }
   
   Working API call:
   {
     model: "gemini-2.5-flash-exp", 
     messages: [...], // what changed?
     tools: [...],
     ...
   }
   ```

7. Focus on:
   - Tool function declarations
   - System message inclusion
   - Message role formatting
   - Any priming or activation content
   - Request parameter differences

DELIVERABLES:
Write findings to: /Users/acoliver/projects/llxprt-code/reports/api-comparison-worker.md

Include:
- Exact API request construction code (with line numbers)
- Side-by-side comparison of first vs working requests
- What changes between attempts
- Why Flash needs multiple calls
- Root cause of the difference
- Specific fix recommendations

Find the EXACT difference that makes Flash work after warming up!